
<!DOCTYPE html><html lang="en"><head>
<meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1">
<title>Admin — Unity Roguelike Hub</title>
<link rel="stylesheet" href="assets/styles.css">
</head><body>
<div class="container">
  <aside><div class="brand"><div class="logo">RL</div><div><div style="font-weight:800">Admin Panel</div><div class="notice">Update weeks, links, summaries</div></div></div>
  <div class="card"><button id="exportBtn" class="btn dark">Export JSON</button><div style="height:10px"></div><label class="btn ghost" for="importFile" style="display:inline-block;cursor:pointer">Import JSON</label><input id="importFile" type="file" accept="application/json" style="display:none" /></div>
  <div class="card notice">This edits a local copy. Export to overwrite <code>data/weeks.js</code> in your repo for the student site.</div></aside>
  <main>
    <h1>Edit Week Content</h1>
    <div style="display:flex;gap:10px;flex-wrap:wrap"><select id="weekSelect"></select><button id="addTask" class="btn ghost">Add Task</button></div>
    <div id="editor"></div>
  </main>
</div>
<script type="module">
import {el} from './js/app.js'; import DATA from './data/weeks.js';
let working = structuredClone(DATA);
const weekSelect = document.getElementById('weekSelect');
function renderWeeksOptions(){ weekSelect.innerHTML = working.weeks.map((w,i)=>`<option value="${i}">Week ${i+1} — ${w.title}</option>`).join(''); }
function currentWeek(){ return working.weeks[parseInt(weekSelect.value||0)]; }
function renderEditor(){
  const wrap=document.getElementById('editor'); wrap.innerHTML=''; const w=currentWeek();
  wrap.appendChild(el(`<div class="card"><label>Week title</label><input id="wtitle" value="${w.title}"/></div>`));
  document.getElementById('wtitle').addEventListener('input', e=> w.title=e.target.value);
  w.tasks.forEach((t,ix)=>{
    const node = el(`<div class="card">
      <h3>Task ${ix+1}: <input value="${t.title}" id="t-${t.id}-title"/></h3>
      <label>Micro-steps (one per line)</label><textarea id="t-${t.id}-micro" rows="5">${t.micro.join('\n')}</textarea>
      <div class="grid" style="margin-top:10px">
        <div class="card" style="grid-column:span 6"><h4>Short Video</h4><label>Label</label><input id="t-${t.id}-slabel" value="${t.resources.short.label||''}"/><label>URL</label><input id="t-${t.id}-surl" value="${t.resources.short.url||''}"/></div>
        <div class="card" style="grid-column:span 6"><h4>Optional Long Video</h4><label>Label</label><input id="t-${t.id}-llabel" value="${t.resources.long.label||''}"/><label>URL</label><input id="t-${t.id}-lurl" value="${t.resources.long.url||''}"/></div>
        <div class="card" style="grid-column:span 12"><h4>Article</h4><label>Label</label><input id="t-${t.id}-alabel" value="${t.resources.article.label||''}"/><label>URL</label><input id="t-${t.id}-aurl" value="${t.resources.article.url||''}"/><label>Summary</label><textarea id="t-${t.id}-asum" rows="4">${t.resources.article.summary||''}</textarea></div>
      </div>
    </div>`);
    wrap.appendChild(node);
    node.querySelector(`#t-${t.id}-title`).addEventListener('input', e=> t.title=e.target.value);
    node.querySelector(`#t-${t.id}-micro`).addEventListener('input', e=> t.micro = e.target.value.split('\n').map(s=>s.trim()).filter(Boolean));
    node.querySelector(`#t-${t.id}-slabel`).addEventListener('input', e=> t.resources.short.label=e.target.value);
    node.querySelector(`#t-${t.id}-surl`).addEventListener('input', e=> t.resources.short.url=e.target.value);
    node.querySelector(`#t-${t.id}-llabel`).addEventListener('input', e=> t.resources.long.label=e.target.value);
    node.querySelector(`#t-${t.id}-lurl`).addEventListener('input', e=> t.resources.long.url=e.target.value);
    node.querySelector(`#t-${t.id}-alabel`).addEventListener('input', e=> t.resources.article.label=e.target.value);
    node.querySelector(`#t-${t.id}-aurl`).addEventListener('input', e=> t.resources.article.url=e.target.value);
    node.querySelector(`#t-${t.id}-asum`).addEventListener('input', e=> t.resources.article.summary=e.target.value);
  });
}
document.getElementById('addTask').addEventListener('click', ()=>{ const w=currentWeek(); const id=`${w.id}-t${w.tasks.length+1}`; w.tasks.push({id, title:'New Task', micro:['Step 1','Step 2'], resources:{short:{}, long:{}, article:{}}}); renderEditor(); });
document.getElementById('exportBtn').addEventListener('click', ()=>{ const blob=new Blob([`export default ${JSON.stringify(working,null,2)};`],{type:'application/javascript'}); const url=URL.createObjectURL(blob); const a=document.createElement('a'); a.href=url; a.download='weeks.js'; a.click(); URL.revokeObjectURL(url); });
document.getElementById('importFile').addEventListener('change',(e)=>{ const file=e.target.files[0]; if(!file) return; const r=new FileReader(); r.onload=()=>{{ try{{ const json=JSON.parse(r.result); working=json; renderWeeksOptions(); renderEditor(); }}catch(err){{ alert('Provide raw JSON.'); }} }}; r.readAsText(file); });
renderWeeksOptions(); renderEditor();
</script>
</body></html>
